<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up - Healthfy</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            padding: 20px 0;
        }
        
        .signup-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            max-width: 600px;
            width: 100%;
            margin: auto;
        }
        
        .signup-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .btn-signup {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 10px;
            padding: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-signup:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .form-control {
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 12px;
            transition: all 0.3s ease;
        }
        
        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .form-floating label {
            padding-left: 15px;
        }
        
        .form-select {
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 12px;
            transition: all 0.3s ease;
        }
        
        .form-select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        /* Multi-step form styles */
        .step-indicators {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }
        
        .step-indicator {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            flex: 1;
            text-align: center;
        }
        
        .step-indicator i {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e9ecef;
            color: #6c757d;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
            position: relative;
            z-index: 2;
        }
        
        .step-indicator.active i {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .step-indicator.completed i {
            background: #28a745;
            color: white;
        }
        
        .step-indicator span {
            font-size: 0.85rem;
            font-weight: 500;
            color: #6c757d;
        }
        
        .step-indicator.active span {
            color: #667eea;
            font-weight: 600;
        }
        
        .step-indicator.completed span {
            color: #28a745;
        }
        
        .step-indicator::after {
            content: '';
            position: absolute;
            top: 20px;
            left: 70%;
            width: 60%;
            height: 2px;
            background: #e9ecef;
            z-index: 1;
        }
        
        .step-indicator:last-child::after {
            display: none;
        }
        
        .step-indicator.completed::after {
            background: #28a745;
        }
        
        .step-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        .step-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .step-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .progress-bar {
            transition: width 0.3s ease;
        }
        
        @media (max-width: 768px) {
            .step-indicator span {
                font-size: 0.75rem;
            }
            
            .step-indicator i {
                width: 35px;
                height: 35px;
            }
            
            .signup-container {
                max-width: 95%;
                margin: 10px;
            }
        }
        
        /* Form validation styles */
        .form-control.is-invalid {
            border-color: #dc3545;
            box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
        }
        
        .form-select.is-invalid {
            border-color: #dc3545;
            box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
        }
    </style>
</head>
<body>
    <div class="signup-container">
        <!-- Header -->
        <div class="signup-header">
            <h2 class="mb-3">
                <i class="fas fa-heartbeat me-2"></i>
                Healthfy
            </h2>
            <p class="mb-0">Create your healthcare account to get started.</p>
        </div>
        
        <!-- Form Body -->
        <div class="p-4">
            <!-- Alert Messages -->
            <% if (typeof error !== 'undefined' && error && error.length) { %>
                <div class="alert alert-danger">
                    <i class="fas fa-exclamation-circle me-2"></i>
                    <%= Array.isArray(error) ? error[0] : error %>
                </div>
            <% } %>
            
            <% if (typeof success !== 'undefined' && success && success.length) { %>
                <div class="alert alert-success">
                    <i class="fas fa-check-circle me-2"></i>
                    <%= Array.isArray(success) ? success[0] : success %>
                </div>
            <% } %>
            
            <!-- Multi-step form with tabs -->
            <div id="registrationWizard">
                <!-- Progress bar -->
                <div class="progress mb-4" style="height: 6px;">
                    <div class="progress-bar bg-gradient-primary" role="progressbar" style="width: 25%" id="progressBar"></div>
                </div>
                
                <!-- Step indicators -->
                <div class="step-indicators mb-4">
                    <div class="step-indicator active" data-step="1">
                        <i class="fas fa-user"></i>
                        <span>Basic Info</span>
                    </div>
                    <div class="step-indicator" data-step="2">
                        <i class="fas fa-heartbeat"></i>
                        <span>Health Profile</span>
                    </div>
                    <div class="step-indicator" data-step="3">
                        <i class="fas fa-leaf"></i>
                        <span>Lifestyle</span>
                    </div>
                    <div class="step-indicator" data-step="4">
                        <i class="fas fa-check"></i>
                        <span>Complete</span>
                    </div>
                </div>
                
                <form action="/users/signup" method="POST" id="signupForm">
                    <!-- Step 1: Basic Information -->
                    <div class="step-content active" id="step1">
                        <h4 class="mb-3">Basic Information</h4>
                        
                        <div class="row">
                            <div class="col-12">
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="name" name="name" placeholder="Full Name" required>
                                    <label for="name">
                                        <i class="fas fa-user me-2"></i>Full Name
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="email" class="form-control" id="email" name="email" placeholder="name@example.com" required>
                                    <label for="email">
                                        <i class="fas fa-envelope me-2"></i>Email address
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="password" class="form-control" id="password" name="password" placeholder="Password" required minlength="8">
                                    <label for="password">
                                        <i class="fas fa-lock me-2"></i>Password
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="date" class="form-control" id="dob" name="dob" required>
                                    <label for="dob">
                                        <i class="fas fa-calendar me-2"></i>Date of Birth
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <select class="form-select" id="gender" name="gender" required>
                                        <option value="">Select Gender</option>
                                        <option value="male">Male</option>
                                        <option value="female">Female</option>
                                        <option value="other">Other</option>
                                    </select>
                                    <label for="gender">
                                        <i class="fas fa-venus-mars me-2"></i>Gender
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-floating mb-3">
                            <input type="tel" class="form-control" id="phone" name="phone" placeholder="Phone Number">
                            <label for="phone">
                                <i class="fas fa-phone me-2"></i>Phone Number
                            </label>
                        </div>
                        
                        <!-- Address -->
                        <h5 class="mt-4 mb-3">Address Information</h5>
                        <div class="row">
                            <div class="col-12">
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="street" name="street" placeholder="Street Address">
                                    <label for="street">
                                        <i class="fas fa-map-marker-alt me-2"></i>Street Address
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="city" name="city" placeholder="City">
                                    <label for="city">
                                        <i class="fas fa-city me-2"></i>City
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="state" name="state" placeholder="State/Province">
                                    <label for="state">
                                        <i class="fas fa-flag me-2"></i>State/Province
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="country" name="country" placeholder="Country">
                                    <label for="country">
                                        <i class="fas fa-globe me-2"></i>Country
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="pincode" name="pincode" placeholder="PIN/Zip Code">
                                    <label for="pincode">
                                        <i class="fas fa-mail-bulk me-2"></i>PIN/Zip Code
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Step 2: Health Profile -->
                    <div class="step-content" id="step2">
                        <h4 class="mb-3">Health Profile</h4>
                        
                        <!-- Basic Measurements -->
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="number" class="form-control" id="height" name="height" placeholder="Height (cm)" min="50" max="300">
                                    <label for="height">
                                        <i class="fas fa-ruler-vertical me-2"></i>Height (cm)
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="number" class="form-control" id="weight" name="weight" placeholder="Weight (kg)" min="10" max="500">
                                    <label for="weight">
                                        <i class="fas fa-weight me-2"></i>Weight (kg)
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Blood Group -->
                        <div class="form-floating mb-3">
                            <select class="form-select" id="bloodGroup" name="bloodGroup">
                                <option value="">Select Blood Group</option>
                                <option value="A+">A+</option>
                                <option value="A-">A-</option>
                                <option value="B+">B+</option>
                                <option value="B-">B-</option>
                                <option value="O+">O+</option>
                                <option value="O-">O-</option>
                                <option value="AB+">AB+</option>
                                <option value="AB-">AB-</option>
                            </select>
                            <label for="bloodGroup">
                                <i class="fas fa-tint me-2"></i>Blood Group
                            </label>
                        </div>
                        
                        <!-- Blood Pressure -->
                        <h5 class="mt-4 mb-3">Blood Pressure</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="number" class="form-control" id="systolic" name="systolic" placeholder="Systolic" min="70" max="250">
                                    <label for="systolic">
                                        <i class="fas fa-heartbeat me-2"></i>Systolic (mmHg)
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="number" class="form-control" id="diastolic" name="diastolic" placeholder="Diastolic" min="40" max="150">
                                    <label for="diastolic">
                                        <i class="fas fa-heartbeat me-2"></i>Diastolic (mmHg)
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Blood Sugar -->
                        <h5 class="mt-4 mb-3">Blood Sugar Levels</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="number" class="form-control" id="fastingBloodSugar" name="fastingBloodSugar" placeholder="Fasting" min="50" max="500">
                                    <label for="fastingBloodSugar">
                                        <i class="fas fa-vial me-2"></i>Fasting (mg/dL)
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="number" class="form-control" id="postMealBloodSugar" name="postMealBloodSugar" placeholder="Post-meal" min="50" max="500">
                                    <label for="postMealBloodSugar">
                                        <i class="fas fa-vial me-2"></i>Post-meal (mg/dL)
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-floating mb-3">
                            <input type="number" step="0.1" class="form-control" id="hba1c" name="hba1c" placeholder="HbA1c" min="4" max="15">
                            <label for="hba1c">
                                <i class="fas fa-chart-line me-2"></i>HbA1c (%)
                            </label>
                        </div>
                        
                        <!-- Heart Rate and Temperature -->
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="number" class="form-control" id="heartRate" name="heartRate" placeholder="Heart Rate" min="30" max="200">
                                    <label for="heartRate">
                                        <i class="fas fa-heart me-2"></i>Heart Rate (bpm)
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="number" step="0.1" class="form-control" id="temperature" name="temperature" placeholder="Body Temperature" min="95" max="110">
                                    <label for="temperature">
                                        <i class="fas fa-thermometer-half me-2"></i>Temperature (°F)
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Medical History -->
                        <div class="form-floating mb-3">
                            <textarea class="form-control" id="medicalHistory" name="medicalHistory" placeholder="Medical History" style="height: 100px;"></textarea>
                            <label for="medicalHistory">
                                <i class="fas fa-notes-medical me-2"></i>Medical History (Optional)
                            </label>
                        </div>
                        
                        <!-- Allergies -->
                        <div class="form-floating mb-3">
                            <textarea class="form-control" id="allergies" name="allergies" placeholder="Any known allergies" style="height: 80px;"></textarea>
                            <label for="allergies">
                                <i class="fas fa-exclamation-triangle me-2"></i>Allergies (Optional)
                            </label>
                        </div>
                        
                        <!-- Current Medications -->
                        <div class="form-floating mb-3">
                            <textarea class="form-control" id="currentMedications" name="currentMedications" placeholder="Current medications" style="height: 80px;"></textarea>
                            <label for="currentMedications">
                                <i class="fas fa-pills me-2"></i>Current Medications (Optional)
                            </label>
                        </div>
                    </div>
                    
                    <!-- Step 3: Lifestyle -->
                    <div class="step-content" id="step3">
                        <h4 class="mb-3">Lifestyle Information</h4>
                        
                        <!-- Diet Preference -->
                        <div class="form-floating mb-3">
                            <select class="form-select" id="diet" name="diet">
                                <option value="">Select Diet Preference</option>
                                <option value="vegetarian">Vegetarian</option>
                                <option value="non-vegetarian">Non-Vegetarian</option>
                                <option value="vegan">Vegan</option>
                                <option value="other">Other</option>
                            </select>
                            <label for="diet">
                                <i class="fas fa-leaf me-2"></i>Diet Preference
                            </label>
                        </div>
                        
                        <!-- Exercise Frequency -->
                        <div class="form-floating mb-3">
                            <select class="form-select" id="exerciseFrequency" name="exerciseFrequency">
                                <option value="">Select Exercise Frequency</option>
                                <option value="none">None</option>
                                <option value="low">Low (1-2 times/week)</option>
                                <option value="moderate">Moderate (3-4 times/week)</option>
                                <option value="high">High (5+ times/week)</option>
                            </select>
                            <label for="exerciseFrequency">
                                <i class="fas fa-running me-2"></i>Exercise Frequency
                            </label>
                        </div>
                        
                        <!-- Sleep Hours -->
                        <div class="form-floating mb-3">
                            <input type="number" class="form-control" id="sleepHours" name="sleepHours" placeholder="Sleep Hours" min="3" max="15" step="0.5">
                            <label for="sleepHours">
                                <i class="fas fa-bed me-2"></i>Average Sleep Hours per Day
                            </label>
                        </div>
                        
                        <!-- Stress Level -->
                        <div class="form-floating mb-3">
                            <select class="form-select" id="stressLevel" name="stressLevel">
                                <option value="">Select Stress Level</option>
                                <option value="1">1 - Very Low</option>
                                <option value="2">2 - Low</option>
                                <option value="3">3 - Mild</option>
                                <option value="4">4 - Moderate-Low</option>
                                <option value="5">5 - Moderate</option>
                                <option value="6">6 - Moderate-High</option>
                                <option value="7">7 - High</option>
                                <option value="8">8 - Very High</option>
                                <option value="9">9 - Extremely High</option>
                                <option value="10">10 - Maximum</option>
                            </select>
                            <label for="stressLevel">
                                <i class="fas fa-brain me-2"></i>Stress Level (1-10)
                            </label>
                        </div>
                        
                        <!-- Water Intake -->
                        <div class="form-floating mb-3">
                            <input type="number" step="0.5" class="form-control" id="waterIntake" name="waterIntake" placeholder="Water Intake" min="0.5" max="10">
                            <label for="waterIntake">
                                <i class="fas fa-tint me-2"></i>Daily Water Intake (Liters)
                            </label>
                        </div>
                        
                        <!-- Smoking and Alcohol -->
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="smoking" name="smoking">
                                    <label class="form-check-label" for="smoking">
                                        <i class="fas fa-smoking me-2"></i>Do you smoke?
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="alcohol" name="alcohol">
                                    <label class="form-check-label" for="alcohol">
                                        <i class="fas fa-wine-glass me-2"></i>Do you consume alcohol?
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Emergency Contact -->
                        <h5 class="mt-4 mb-3">Emergency Contact</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="emergencyName" name="emergencyName" placeholder="Emergency Contact Name">
                                    <label for="emergencyName">
                                        <i class="fas fa-user-friends me-2"></i>Name
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="emergencyRelation" name="emergencyRelation" placeholder="Relationship">
                                    <label for="emergencyRelation">
                                        <i class="fas fa-heart me-2"></i>Relationship
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="tel" class="form-control" id="emergencyPhone" name="emergencyPhone" placeholder="Emergency Contact Phone">
                            <label for="emergencyPhone">
                                <i class="fas fa-phone-alt me-2"></i>Emergency Contact Phone
                            </label>
                        </div>
                    </div>
                    
                    <!-- Step 4: Terms and Submit -->
                    <div class="step-content" id="step4">
                        <h4 class="mb-3">Review & Complete</h4>
                        
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>Review your information:</strong> Please review all the information you've provided. You can go back to any step to make changes before submitting.
                        </div>
                        
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="terms" name="terms" required>
                            <label class="form-check-label" for="terms">
                                I agree to the <a href="/terms" target="_blank">Terms of Service</a> and 
                                <a href="/privacy" target="_blank">Privacy Policy</a>
                            </label>
                        </div>
                        
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="privacyConsent" name="privacyConsent" required>
                            <label class="form-check-label" for="privacyConsent">
                                I consent to the collection and processing of my health data as described in the Privacy Policy
                            </label>
                        </div>
                        
                        <div class="form-check mb-4">
                            <input class="form-check-input" type="checkbox" id="emailNotifications" name="emailNotifications" checked>
                            <label class="form-check-label" for="emailNotifications">
                                I would like to receive health tips and updates via email (optional)
                            </label>
                        </div>
                    </div>
                    
                    <!-- Navigation Buttons -->
                    <div class="step-navigation mt-4">
                        <button type="button" class="btn btn-secondary" id="prevBtn" onclick="changeStep(-1)" style="display: none;">Previous</button>
                        <button type="button" class="btn btn-primary" id="nextBtn" onclick="changeStep(1)">Next</button>
                        <button type="submit" class="btn btn-success" id="submitBtn" style="display: none;">
                            <i class="fas fa-user-plus me-2"></i>Create Account
                        </button>
                    </div>
                </form>
            </div>
            
            <hr class="my-4">
            
            <div class="text-center">
                <p class="mb-0">Already have an account? 
                    <a href="/users/login" class="text-decoration-none fw-bold">Sign in here</a>
                </p>
            </div>
        </div>
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        let currentStep = 1;
        const totalSteps = 4;
        
        function changeStep(direction) {
            console.log(`changeStep called with direction: ${direction}, current step: ${currentStep}`);
            
            const currentStepElement = document.getElementById(`step${currentStep}`);
            const currentIndicator = document.querySelector(`[data-step="${currentStep}"]`);
            
            console.log('Current step element:', currentStepElement);
            console.log('Current indicator:', currentIndicator);
            
            // Check bounds
            if (currentStep + direction < 1 || currentStep + direction > totalSteps) {
                console.log('Invalid step bounds');
                return;
            }
            
            // Validate current step before proceeding
            if (direction > 0 && !validateCurrentStep()) {
                console.log('Validation failed');
                return;
            }
            
            console.log('Proceeding with step change');
            
            // Hide current step
            if (currentStepElement) {
                currentStepElement.classList.remove('active');
            }
            
            // Mark current step as completed when moving forward
            if (direction > 0 && currentIndicator) {
                currentIndicator.classList.add('completed');
            }
            
            // Update current step
            currentStep += direction;
            
            // Show new step
            const newStepElement = document.getElementById(`step${currentStep}`);
            const newIndicator = document.querySelector(`[data-step="${currentStep}"]`);
            
            if (newStepElement) {
                newStepElement.classList.add('active');
            }
            
            if (newIndicator) {
                // Remove active from all indicators first
                document.querySelectorAll('.step-indicator').forEach(indicator => {
                    indicator.classList.remove('active');
                });
                // Add active to current indicator
                newIndicator.classList.add('active');
            }
            
            // Update progress bar
            const progressBar = document.getElementById('progressBar');
            if (progressBar) {
                const progressWidth = (currentStep / totalSteps) * 100;
                progressBar.style.width = progressWidth + '%';
            }
            
            // Update navigation buttons
            updateNavigationButtons();
            
            console.log(`Successfully changed to step ${currentStep}`);
            
            // Scroll to top of form
            try {
                document.querySelector('.signup-container').scrollIntoView({ behavior: 'smooth', block: 'start' });
            } catch (e) {
                console.log('Scroll error:', e);
            }
        }
        
        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const submitBtn = document.getElementById('submitBtn');
            
            // Show/hide previous button
            if (currentStep > 1) {
                prevBtn.style.display = 'inline-block';
            } else {
                prevBtn.style.display = 'none';
            }
            
            // Show/hide next/submit button
            if (currentStep < totalSteps) {
                nextBtn.style.display = 'inline-block';
                submitBtn.style.display = 'none';
            } else {
                nextBtn.style.display = 'none';
                submitBtn.style.display = 'inline-block';
            }
        }
        
        function validateCurrentStep() {
            console.log(`Validating step ${currentStep}`);
            const currentStepElement = document.getElementById(`step${currentStep}`);
            
            // Only validate step 1 and only basic fields
            if (currentStep === 1) {
                const name = document.getElementById('name');
                const email = document.getElementById('email');
                const password = document.getElementById('password');
                const dob = document.getElementById('dob');
                const gender = document.getElementById('gender');
                
                let isValid = true;
                
                // Check only essential fields
                if (!name.value.trim()) {
                    name.classList.add('is-invalid');
                    isValid = false;
                } else {
                    name.classList.remove('is-invalid');
                }
                
                if (!email.value.trim()) {
                    email.classList.add('is-invalid');
                    isValid = false;
                } else {
                    email.classList.remove('is-invalid');
                }
                
                if (!password.value.trim() || password.value.length < 8) {
                    password.classList.add('is-invalid');
                    isValid = false;
                } else {
                    password.classList.remove('is-invalid');
                }
                
                if (!dob.value.trim()) {
                    dob.classList.add('is-invalid');
                    isValid = false;
                } else {
                    dob.classList.remove('is-invalid');
                }
                
                if (!gender.value.trim()) {
                    gender.classList.add('is-invalid');
                    isValid = false;
                } else {
                    gender.classList.remove('is-invalid');
                }
                
                if (!isValid) {
                    showErrorMessage('Please fill in all required fields before proceeding.');
                }
                
                console.log(`Step 1 validation result: ${isValid}`);
                return isValid;
            }
            
            // For steps 2 and 3, allow progression without validation
            console.log(`Step ${currentStep} - no validation required`);
            return true;
        }
        
        function showErrorMessage(message) {
            // Remove existing error message
            const existingError = document.querySelector('.step-error');
            if (existingError) {
                existingError.remove();
            }
            
            // Create and show new error message
            const errorDiv = document.createElement('div');
            errorDiv.className = 'alert alert-danger step-error mt-3';
            errorDiv.innerHTML = `<i class="fas fa-exclamation-circle me-2"></i>${message}`;
            
            const currentStepElement = document.getElementById(`step${currentStep}`);
            currentStepElement.appendChild(errorDiv);
            
            // Remove error message after 5 seconds
            setTimeout(() => {
                if (errorDiv) {
                    errorDiv.remove();
                }
            }, 5000);
        }
        
        // Auto-calculate BMI when height and weight are entered
        function setupBMICalculation() {
            const heightInput = document.getElementById('height');
            const weightInput = document.getElementById('weight');
            
            if (heightInput) {
                heightInput.addEventListener('input', calculateBMI);
            }
            if (weightInput) {
                weightInput.addEventListener('input', calculateBMI);
            }
        }
        
        function calculateBMI() {
            const height = parseFloat(document.getElementById('height').value);
            const weight = parseFloat(document.getElementById('weight').value);
            
            if (height && weight && height > 0 && weight > 0) {
                const bmi = weight / Math.pow(height / 100, 2);
                const bmiValue = Math.round(bmi * 10) / 10;
                
                // Show BMI information
                let bmiInfo = document.getElementById('bmi-info');
                if (!bmiInfo) {
                    bmiInfo = document.createElement('div');
                    bmiInfo.id = 'bmi-info';
                    bmiInfo.className = 'alert alert-info mt-2';
                    document.getElementById('weight').parentNode.parentNode.appendChild(bmiInfo);
                }
                
                let bmiCategory = '';
                if (bmiValue < 18.5) bmiCategory = 'Underweight';
                else if (bmiValue < 25) bmiCategory = 'Normal weight';
                else if (bmiValue < 30) bmiCategory = 'Overweight';
                else bmiCategory = 'Obese';
                
                bmiInfo.innerHTML = `<i class="fas fa-calculator me-2"></i>Your BMI: <strong>${bmiValue}</strong> (${bmiCategory})`;
            }
        }
        
        // Step indicator click functionality
        document.querySelectorAll('.step-indicator').forEach((indicator, index) => {
            indicator.addEventListener('click', function() {
                const targetStep = index + 1;
                if (targetStep < currentStep || targetStep === currentStep) {
                    // Allow going back to previous steps or staying on current step
                    const difference = targetStep - currentStep;
                    for (let i = 0; i < Math.abs(difference); i++) {
                        if (difference < 0) {
                            changeStep(-1);
                        }
                    }
                }
            });
        });
        
        // Form submission
        document.getElementById('signupForm').addEventListener('submit', function(e) {
            if (!validateCurrentStep()) {
                e.preventDefault();
                return;
            }
            
            // Show loading state
            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Creating Account...';
            submitBtn.disabled = true;
            
            // Re-enable button after a few seconds in case of form errors
            setTimeout(() => {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }, 10000);
        });
        
        // Initialize form
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM Content Loaded - Initializing form');
            updateNavigationButtons();
            setupBMICalculation();
            
            // Test if elements exist
            console.log('Step 1 exists:', document.getElementById('step1') !== null);
            console.log('Next button exists:', document.getElementById('nextBtn') !== null);
            console.log('changeStep function exists:', typeof changeStep !== 'undefined');
            
            // Add test button click handler
            const nextBtn = document.getElementById('nextBtn');
            if (nextBtn) {
                nextBtn.addEventListener('click', function() {
                    console.log('Next button clicked via event listener');
                });
            }
        });
        
        // Simple test function
        function testNextStep() {
            console.log('Test function called');
            changeStep(1);
        }
    </script>
</body>
</html>
